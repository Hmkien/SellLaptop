@using WebsiteSellLaptop.Models.Enums
@{
    ViewData["Title"] = "Dashboard";
    var totalRevenue = ViewBag.TotalRevenue ?? 0m;
    var pendingOrders = ViewBag.PendingOrders ?? 0;
    var recentOrders = ViewBag.RecentOrders as List<Order> ?? new List<Order>();
    var topProducts = ViewBag.TopProducts as dynamic ?? new List<dynamic>();
    var monthlyRevenue = ViewBag.MonthlyRevenue as dynamic ?? new List<dynamic>();
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h3 class="fw-bold mb-1"><i class="bi bi-grid-1x2 me-2"></i>Dashboard</h3>
        <p class="text-muted mb-0">Tổng quan hoạt động hệ thống</p>
    </div>
    <div class="text-muted small">
        <i class="bi bi-calendar3 me-1"></i>@DateTime.Now.ToString("dd/MM/yyyy HH:mm")
    </div>
</div>

<!-- Main Stats -->
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="stat-card" style="border-left: 4px solid #2563eb">
            <div class="stat-icon" style="background:#eef2ff;color:#2563eb"><i class="bi bi-laptop-fill"></i></div>
            <div class="stat-info">
                <div class="stat-value text-primary">@ViewBag.TotalProducts</div>
                <div class="stat-label">Sản phẩm</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card" style="border-left: 4px solid #16a34a">
            <div class="stat-icon" style="background:#dcfce7;color:#16a34a"><i class="bi bi-receipt-cutoff"></i></div>
            <div class="stat-info">
                <div class="stat-value text-success">@ViewBag.TotalOrders</div>
                <div class="stat-label">Đơn hàng</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card" style="border-left: 4px solid #d97706">
            <div class="stat-icon" style="background:#fef3c7;color:#d97706"><i class="bi bi-currency-dollar"></i></div>
            <div class="stat-info">
                <div class="stat-value" style="color:#d97706">@totalRevenue.ToString("N0")</div>
                <div class="stat-label">Doanh thu (VNĐ)</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card" style="border-left: 4px solid #ef4444">
            <div class="stat-icon" style="background:#fee2e2;color:#ef4444"><i class="bi bi-hourglass-split"></i></div>
            <div class="stat-info">
                <div class="stat-value text-danger">@pendingOrders</div>
                <div class="stat-label">Chờ xử lý</div>
            </div>
        </div>
    </div>
</div>

<!-- Secondary Stats -->
<div class="row g-3 mb-4">
    <div class="col-md-2">
        <div class="stat-card">
            <div class="stat-icon" style="background:#e0f2fe;color:#0284c7"><i class="bi bi-people-fill"></i></div>
            <div class="stat-info">
                <div class="stat-value">@ViewBag.TotalUsers</div>
                <div class="stat-label">Người dùng</div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card">
            <div class="stat-icon" style="background:#f3e8ff;color:#9333ea"><i class="bi bi-folder-fill"></i></div>
            <div class="stat-info">
                <div class="stat-value">@ViewBag.TotalCategories</div>
                <div class="stat-label">Danh mục</div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card">
            <div class="stat-icon" style="background:#fce7f3;color:#db2777"><i class="bi bi-award-fill"></i></div>
            <div class="stat-info">
                <div class="stat-value">@ViewBag.TotalBrands</div>
                <div class="stat-label">Thương hiệu</div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card">
            <div class="stat-icon" style="background:#fed7aa;color:#ea580c"><i class="bi bi-journal-text"></i></div>
            <div class="stat-info">
                <div class="stat-value">@ViewBag.TotalBlogs</div>
                <div class="stat-label">Bài viết</div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card">
            <div class="stat-icon" style="background:#dbeafe;color:#1d4ed8"><i class="bi bi-images"></i></div>
            <div class="stat-info">
                <div class="stat-value">-</div>
                <div class="stat-label">Banner</div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="stat-card">
            <div class="stat-icon" style="background:#e0e7ff;color:#4f46e5"><i class="bi bi-building"></i></div>
            <div class="stat-info">
                <div class="stat-value">-</div>
                <div class="stat-label">Đối tác</div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Recent Orders -->
    <div class="col-lg-7">
        <div class="admin-card">
            <div class="admin-card-header">
                <h5><i class="bi bi-receipt me-2"></i>Đơn hàng gần đây</h5>
                <a asp-action="Index" asp-controller="Order" class="btn btn-sm btn-brand">Xem tất cả</a>
            </div>
            <div class="admin-card-body">
                @if (recentOrders.Count == 0)
                {
                    <div class="text-center py-5 text-muted">
                        <i class="bi bi-inbox" style="font-size:48px"></i>
                        <p class="mt-3">Chưa có đơn hàng nào</p>
                    </div>
                }
                else
                {
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Mã đơn</th>
                                <th>Khách hàng</th>
                                <th>Tổng tiền</th>
                                <th>Trạng thái</th>
                                <th>Ngày</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var order in recentOrders)
                            {
                                <tr>
                                    <td><a asp-action="Detail" asp-controller="Order" asp-route-id="@order.Id" class="record-title">@order.OrderCode</a></td>
                                    <td>@order.User?.FullName</td>
                                    <td class="fw-semibold">@order.TotalAmount.ToString("N0") đ</td>
                                    <td>
                                        @switch (order.OrderStatus)
                                        {
                                            case OrderStatus.Pending: <span class="badge-status badge-pending"><i class="bi bi-clock me-1"></i>Chờ xử lý</span> break;
                                            case OrderStatus.Confirmed: <span class="badge-status" style="background:#dbeafe;color:#1e40af"><i class="bi bi-check-circle me-1"></i>Đã xác nhận</span> break;
                                            case OrderStatus.Shipping: <span class="badge-status" style="background:#e0e7ff;color:#4f46e5"><i class="bi bi-truck me-1"></i>Đang giao</span> break;
                                            case OrderStatus.Completed: <span class="badge-status badge-approved"><i class="bi bi-check-circle me-1"></i>Hoàn thành</span> break;
                                            case OrderStatus.Cancelled: <span class="badge-status badge-rejected"><i class="bi bi-x-circle me-1"></i>Đã hủy</span> break;
                                        }
                                    </td>
                                    <td class="small text-muted">@order.Created.ToString("dd/MM/yyyy")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>
    </div>

    <!-- Top Products -->
    <div class="col-lg-5">
        <div class="admin-card">
            <div class="admin-card-header">
                <h5><i class="bi bi-bar-chart-fill me-2"></i>Sản phẩm bán chạy</h5>
            </div>
            <div class="admin-card-body p-3">
                @if (topProducts.Count == 0)
                {
                    <div class="text-center py-5 text-muted">
                        <i class="bi bi-graph-down" style="font-size:48px"></i>
                        <p class="mt-3">Chưa có dữ liệu bán hàng</p>
                    </div>
                }
                else
                {
                    <div class="list-group list-group-flush">
                        @foreach (var product in topProducts)
                        {
                            <div class="list-group-item border-0 px-0">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-semibold">@product.ProductName</div>
                                        <small class="text-muted">Đã bán: @product.TotalSold sản phẩm</small>
                                    </div>
                                    <div class="stat-icon" style="width:40px;height:40px;background:#eef2ff;color:#2563eb;font-size:16px">
                                        <i class="bi bi-trophy-fill"></i>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row g-3 mt-2">
    <div class="col-md-3">
        <a asp-action="Create" asp-controller="Product" class="admin-card p-4 text-center text-decoration-none d-block" style="border: 2px dashed var(--border)">
            <i class="bi bi-plus-circle" style="font-size:32px;color:var(--brand)"></i>
            <div class="fw-semibold mt-2">Thêm sản phẩm mới</div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-action="Index" asp-controller="Order" class="admin-card p-4 text-center text-decoration-none d-block" style="border: 2px dashed var(--border)">
            <i class="bi bi-receipt" style="font-size:32px;color:#16a34a"></i>
            <div class="fw-semibold mt-2">Quản lý đơn hàng</div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-action="Create" asp-controller="Blog" class="admin-card p-4 text-center text-decoration-none d-block" style="border: 2px dashed var(--border)">
            <i class="bi bi-file-earmark-text" style="font-size:32px;color:#d97706"></i>
            <div class="fw-semibold mt-2">Viết bài mới</div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-action="Index" asp-controller="Contact" class="admin-card p-4 text-center text-decoration-none d-block" style="border: 2px dashed var(--border)">
            <i class="bi bi-envelope" style="font-size:32px;color:#ef4444"></i>
            <div class="fw-semibold mt-2">Xem liên hệ</div>
        </a>
    </div>
</div>

@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
}
